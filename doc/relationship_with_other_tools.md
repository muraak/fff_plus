# 他のテストツールとの比較

FFF Plusはテスト時のスタブの作成を補助するツールですが、本書では、同じような目的で提供されているツールとの使い分けやそもそもスタブを作成するメリットについて説明します。

## なぜスタブ作成ツールが必要？

スタブとはテスト対象の関数が内部でコールする関数のダミーです。テスト時にスタブを作成する主な目的は以下です。

1. テストする時点でその関数が未実装である
2. テスト対象の関数が内部でコールする関数に適切な引数を渡しているか確認したい
3. テスト対象の関数が内部でコールする関数の戻り値または出力引数の値によって出力を変えるため、テストコードで制御したい

目的が１であれば、単に空もしくは簡単なハードコードを書いたダミーを用意すれば済みますが、多くの場合真の目的は2や3になるでしょう。というのは、多くの実用的な関数は入力引数のみで出力が決まるような理想的な構造ではないことがほとんどであるからです。逆に、これらの目的から目を背け、理想的でない構造ぼ関数に対して形式的な入出力の検証のみで済ましているテストは、ほとんどの実用的なソフトウェアにとって不十分であるといえます。
本ツールをはじめとするスタブ作成補助ツールは、単にスタブを作成することでなく、スタブを制御する機構を手間なく提供することを目的としています。
具体的には主に以下の機能を提供します:

1. スタブが呼ばれたときの戻り値をテストコードで制御する
2. スタブが呼ばれた時点での入力引数の値を保存してテストコードで参照できるようにする
3. スタブが呼ばれた時点での出力引数をテストコードで制御する


## C++におけるツール比較

本ツール FFF Plusを含む[FFF](https://github.com/meekrosoft/fff)と[gmock(GoogleTest)](https://github.com/google/googletest)の比較を示します。

比較項目|FFF Plus|FFF|gmock
---|---|---|---
対応範囲（インターフェース（純粋仮想クラス））|OK：対応|OK：対応|OK：対応|
対応範囲（具象クラスのメンバ関数）|OK：対応|NG：非対応|NG：非対応
対応範囲（自由関数）|OK：対応|OK：対応（例外指定子NG）|NG：非対応
スタブの呼び方|Fake|Fake|Mock
スタブの制御方法|FFFと同じ|Fake作成時に定義される構造体のメンバに<br>アクセスすることで制御する|ExpectCallマクロとActionマクロで制御する
使用感|FFFと同じ|比較的スムーズに導入できる。<br>複雑に制御するには少し手間が掛かる。|とっつきにくいが，<br>慣れれば複雑な制御も比較的手間なく実現可能。
汎用性|FFFと同じ|組み込みシステム上でも使える。|改造なしでは汎用OS以外では利用できない。

## おすすめのツール利用戦略

cpp環境ではfff plusで基本的なスタブをサポートできることからfff plusの利用を推奨します。Assert系の検証マクロ（e.g. `ASSERT_EQ()`など）やテストセット定義マクロ(e.g.`TEST()`など)はGoogleTestを利用するのが手軽です。
組み込みシステムなどのターゲット上でテストすることを想定する場合は，GoogleTestの検証マクロ、テストセット定義などのミニマルなマクロを組み込みシステム向けに独自定義して差替えられるようにすることを推奨します。

以上
